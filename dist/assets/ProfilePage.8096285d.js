import{p as O,y as z,r as i,d as a,L as k,e as w,u as B,q as G,a as m,j as f,B as N,f as F,I as K,l as U,s as J,k as Q,A as S,o as X,F as Y,P as Z}from"./index.3996ea3a.js";import{T,a as M,c as e4}from"./Text.d7c5cc0a.js";import{D as u4}from"./DynamicModuleLoader.a88b5f4e.js";import{I as r4}from"./Input.4d1603a8.js";import{I as a4}from"./InputImg.20d82472.js";import{a as t4,S as s4,f as i4}from"./friendsPageSelectors.5c7cb189.js";import{A as o4}from"./AppImage.c08ece6e.js";import{S as n4}from"./SheetList.1e8e6c61.js";import{S as c4}from"./SeoHead.9f3e0582.js";import"./check.f8f3949b.js";import"./Skeleton.6dbd9952.js";const d4="_profilePageModule_1rhox_1",l4={profilePageModule:d4},H=r=>{var e;return(e=r.profile)==null?void 0:e.form},p4=r=>{var e;return(e=r.profile)==null?void 0:e.isLoading},m4=r=>{var e;return(e=r.profile)==null?void 0:e.error},W=r=>{var e;return(e=r.profile)==null?void 0:e.readonly},b=O("profile/fetchProfileData",async(r,e)=>{const{extra:u,rejectWithValue:t}=e;try{const s=await u.api.get(`/user/auth/${r}`);if(!s.data)throw new Error;return s.data}catch(s){return console.log(s),t("\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 4")}}),A=O("profile/updateProfileData",async(r,e)=>{const{extra:u,rejectWithValue:t,getState:s}=e,o=H(s());try{const c=await u.api.put(`user/auth/${o==null?void 0:o.id}`,o);if(!c.data)throw new Error;return c.data}catch(c){return console.log(c),t("error")}}),f4={readonly:!0,isLoading:!1,error:void 0,data:void 0},V=z({name:"profile",initialState:f4,reducers:{setReadonly:(r,e)=>{r.readonly=e.payload},cancelEdit:r=>{var e,u,t,s;r.readonly=!0,r.form={id:((e=r.data)==null?void 0:e.id)||void 0,name:((u=r.data)==null?void 0:u.name)||"",img:((t=r.data)==null?void 0:t.img)||null,birthday:((s=r.data)==null?void 0:s.birthday)||""}},updateProfile:(r,e)=>{r.form={...r.form,...e.payload}},clearProfile:r=>{r.data=void 0,r.form=void 0,r.isLoading=!1,r.error=void 0,r.validateErrors=void 0}},extraReducers:r=>{r.addCase(b.pending,e=>{e.error=void 0,e.isLoading=!0}).addCase(b.fulfilled,(e,u)=>{var t;e.isLoading=!1,e.data=u.payload,e.form={id:((t=e.data)==null?void 0:t.id)||void 0,name:u.payload.name,img:u.payload.img,birthday:u.payload.birthday}}).addCase(b.rejected,(e,u)=>{e.isLoading=!1,e.error=u.payload}).addCase(A.pending,e=>{e.error=void 0,e.isLoading=!0}).addCase(A.fulfilled,(e,u)=>{var t;e.isLoading=!1,e.data=u.payload,e.form={id:((t=e.data)==null?void 0:t.id)||void 0,name:u.payload.name,img:u.payload.img,birthday:u.payload.birthday},e.readonly=!0}).addCase(A.rejected,(e,u)=>{e.isLoading=!1,e.error=u.payload})}}),{actions:x}=V,{reducer:g4}=V,h4="_ProfileCard_4elvc_1",_4="_paddingProfile_4elvc_34",E4="_wrapp_4elvc_43",C4="_loading_4elvc_85",v4="_error_4elvc_85",N4="_inputImg_4elvc_92",F4="_input_4elvc_92",x4="_fr_4elvc_172",w4="_dr_4elvc_183",B4="_cake_4elvc_209",y4="_addFriends_4elvc_215",P4="_friendOrNo_4elvc_249",L4="_inFr_4elvc_258",p={ProfileCard:h4,paddingProfile:_4,wrapp:E4,loading:C4,error:v4,inputImg:N4,input:F4,fr:x4,dr:w4,cake:B4,addFriends:y4,friendOrNo:P4,inFr:L4},R4=r=>i.exports.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:26,height:26,viewBox:"0 0 24 24",fill:"none",stroke:"#000000",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round",...r},i.exports.createElement("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),i.exports.createElement("circle",{cx:8.5,cy:7,r:4}),i.exports.createElement("line",{x1:20,y1:8,x2:20,y2:14}),i.exports.createElement("line",{x1:23,y1:11,x2:17,y2:11})),j=O("addFriend",async(r,e)=>{const{extra:u,rejectWithValue:t}=e;try{const s=await u.api.post("/subscription/add",r);return console.log(s),s.data}catch(s){return console.log(s),t("\u041D\u0435\u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435")}}),b4=r=>{const{className:e,data:u,error:t,readonly:s,isLoading:o,onChangeName:c,onChangeImg:g,canEdit:l,profileId:n}=r;if(o)return a(k,{});if(t)return a("div",{className:w(p.ProfileCard,{},[e,p.error]),children:a(T,{theme:M.ERROR,title:"\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u043F\u0440\u043E\u0444\u0438\u043B\u044F",text:"\u041F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0443",align:e4.CENTER})});const d=B(),h=i.exports.useMemo(()=>{if(typeof(u==null?void 0:u.img)=="string")return u.img;if((u==null?void 0:u.img)instanceof File)return URL.createObjectURL(u.img)},[u==null?void 0:u.img]),I=i.exports.useCallback(async()=>{if(!(u!=null&&u.id)||!n)return;const C=await d(j({userId:n,subscriptionId:u.id}));j.fulfilled.match(C)&&d(G({idUser:n}))},[d,u==null?void 0:u.id,n]),y=m(t4);let P;return y!==void 0&&(P=Boolean(y.find(C=>C==(u==null?void 0:u.id)))),console.log(u),a("div",{className:p.paddingProfile,children:f("div",{className:p.wrapp,children:[f("div",{className:w(p.ProfileCard,{},[e]),children:[a("div",{className:p.input,children:a(r4,{value:u==null?void 0:u.name,placeholder:"",onChange:c,readonly:s,"data-testid":"ProfileCard.firstname"})}),f("div",{className:p.dr,children:[a(s4,{className:p.cake}),i4(u==null?void 0:u.birthday)]}),a("div",{className:p.friendOrNo,children:!l&&(P==!1?f(N,{className:p.addFriends,onClick:I,theme:F.ACCENT,children:[a(R4,{})," \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0434\u0440\u0443\u0437\u044C\u044F"]}):a("div",{className:p.inFr,children:"\u0423 \u0432\u0430\u0441 \u0432 \u0434\u0440\u0443\u0437\u044C\u044F\u0445"}))})]}),a(a4,{className:p.inputImg,value:h,onChange:g,readonly:s})]})})},A4="_btnCancel_hz0gl_1",v={btnCancel:A4},D4=i.exports.memo(r=>{const{className:e,canEdit:u}=r,t=B(),s=m(W),o=i.exports.useCallback(()=>{t(x.setReadonly(!1))},[t]),c=i.exports.useCallback(()=>{t(x.cancelEdit())},[t]),g=i.exports.useCallback(()=>{t(A())},[t]),l=i.exports.useCallback(()=>{window.confirm("\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0432\u044B\u0439\u0442\u0438?")&&t(K.logout())},[t]);return a("div",{className:w("",{},[e]),children:u&&a("div",{className:v.wrapp,children:s?f("div",{children:[a(N,{theme:F.OUTLINE,onClick:o,"data-testid":"EditableProfileCardHeader.EditButton",className:v.btn,children:"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C"}),a(N,{theme:F.ACCENT,onClick:l,"data-testid":"EditableProfileCardHeader.LogOutButton",className:v.btnCancel,children:"\u0412\u044B\u0439\u0442\u0438"})]}):f("div",{children:[a(N,{theme:F.ACCENT,onClick:c,"data-testid":"EditableProfileCardHeader.CancelButton",className:v.btnCancel,children:"\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C"}),a(N,{theme:F.BACKGROUND,onClick:g,"data-testid":"EditableProfileCardHeader.SaveButton",className:v.btn,children:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C"})]})})})}),T4="_header_1eenu_1",k4="_title_1eenu_17",L={header:T4,title:k4},I4=r=>{var e;return(e=r.profile)==null?void 0:e.validateErrors};var D=(r=>(r.INCORRECT_USER_DATA="INCORRECT_USER_DATA",r.NO_DATA="NO_DATA",r.SERVER_ERROR="SERVER_ERROR",r))(D||{});const $=r=>{var e;return(e=r.profile)==null?void 0:e.data},S4="_wrapper_1o92n_2",O4="_wrapperText_1o92n_14",$4="_wrapperListFr_1o92n_22",j4="_text_1o92n_41",U4="_blockFr_1o92n_45",M4="_img_1o92n_56",E={wrapper:S4,wrapperText:O4,wrapperListFr:$4,text:j4,blockFr:U4,img:M4},H4=i.exports.memo(r=>{var n;const{className:e,canEdit:u,isLoading:t}=r,s=B(),o=U(),c=m($),g=i.exports.useCallback(d=>{o(J(String(d.id)))},[s]);if(!((n=c==null?void 0:c.Subscriptions)!=null&&n.length))return a("div",{className:E.wrapper,children:a("div",{className:E.wrapperText,children:"\u0423 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u043D\u0435\u0442 \u0434\u0440\u0443\u0437\u0435\u0439"})});const l=d=>a(o4,{src:typeof d.img=="string"?d.img:"/placeholder.jpg",className:E.img,onClick:()=>g(d)});return f("div",{className:w("",{},[e]),children:[!u&&a("div",{children:f("div",{className:E.wrapper,children:[a("div",{className:E.text,children:"\u0414\u0440\u0443\u0437\u044C\u044F \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F"}),a("div",{className:E.wrapperListFr,children:c.Subscriptions.length>0?c.Subscriptions.map(l):""})]})}),t&&a(k,{})]})}),W4="_wrapper_alc2w_1",V4="_wrapperListFr_alc2w_17",q4="_text_alc2w_27",z4="_wrapperText_alc2w_41",R={wrapper:W4,wrapperListFr:V4,text:q4,wrapperText:z4},G4=i.exports.memo(r=>{var o;const{className:e,canEdit:u,isLoading:t}=r;B(),U();const s=m($);return(o=s==null?void 0:s.lists)!=null&&o.length?f("div",{className:w("",{},[e]),children:[!u&&a("div",{children:f("div",{className:R.wrapper,children:[a("div",{className:R.text,children:"\u041B\u0438\u0441\u0442\u044B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F"}),s.lists.length>0?a(n4,{myLists:s.lists,ownerId:s.id}):""]})}),t&&a(k,{})]}):a("div",{className:R.wrapper,children:a("div",{className:R.wrapperText,children:"\u0423 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u043D\u0435\u0442 \u043B\u0438\u0441\u0442\u043E\u0432"})})}),K4={profile:g4},J4=i.exports.memo(r=>{const{className:e,id:u}=r,t=B(),s=m(H),o=m(p4),c=m(m4),g=m(W),l=m(Q),n=m($),d=(l==null?void 0:l.id)===(n==null?void 0:n.id),h=m(I4),I={[D.SERVER_ERROR]:"\u0421\u0435\u0440\u0432\u0435\u0440\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438",[D.NO_DATA]:"\u0414\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u044B",[D.INCORRECT_USER_DATA]:"\u0418\u043C\u044F \u0438 \u0444\u0430\u043C\u0438\u043B\u0438\u044F \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B"};i.exports.useEffect(()=>(u&&t(b(u)),()=>{t(x.clearProfile())}),[u,t]);const y=i.exports.useCallback(_=>{t(x.updateProfile({name:_||""}))},[t]),P=i.exports.useCallback(_=>{t(x.updateProfile({img:_}))},[t]),C=d?`\u041F\u0440\u043E\u0444\u0438\u043B\u044C ${(n==null?void 0:n.name)||""} \u2014 ${S}`:`\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u2014 ${S}`,q=d?"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u0441\u0432\u043E\u0439 \u043F\u0440\u043E\u0444\u0438\u043B\u044C: \u0438\u043C\u044F, \u0444\u043E\u0442\u043E \u0438 \u043B\u0438\u0447\u043D\u044B\u0435 \u0434\u0430\u043D\u043D\u044B\u0435.":`\u041F\u0440\u043E\u0444\u0438\u043B\u044C ${(n==null?void 0:n.name)||"\u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F"} \u0432 ${S}.`;return f(u4,{reducers:K4,children:[a(c4,{title:C,description:q,url:`https://vishi.ru/profile/${u}`,image:"/images/preview-profile.jpg"}),(h==null?void 0:h.length)&&h.map(_=>a(T,{theme:M.ERROR,text:I[_],"data-testid":"EditableProfileCard.Error"},_)),a(T,{title:"\u041F\u0440\u043E\u0444\u0438\u043B\u044C",className:L.title,titleTag:"h1"}),a(b4,{data:s,profileId:l==null?void 0:l.id,isLoading:o,error:c,readonly:g,onChangeName:y,onChangeImg:P,canEdit:d}),a(D4,{canEdit:d,className:L.header}),a(H4,{canEdit:d,className:L.list,isLoading:o}),a(G4,{canEdit:d,className:L.list,isLoading:o}),o&&a(k,{})]})}),oe=({className:r})=>{const{id:e}=X();return e?a(Y,{children:a(Z,{children:a("div",{className:l4.profilePageModule,children:a(J4,{id:e})})})}):a(T,{text:"\u041F\u0440\u043E\u0444\u0438\u043B\u044C \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D"})};export{oe as default};
